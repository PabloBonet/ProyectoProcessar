PARAMETERS CAMINO, BASEDATO, SEP1, SEP2
** //\\ 26-08-2006 TULIO ROSSI
**EJ: =dicdatos("c:\proyectos\barnaba\fuentes\datos\facturacion","datos.dbc",20,80)
**** EN MYSQL CORRER DESDE LA LINEA DE COMANDO SHELL REVISAR ANTES EL ARCHIVO Y ELMINAR EN LOS INDICES LOS 
**** ALLTRIM Y DEMAS FUNCIONES DE CONCATENACION
****		mysql -h 127.0.0.1 -u root -D basedato < archivo.sql



** RECIBE COMO PARAMETRO EL PATH DE LA BASE DE DATOS
** EL NOMBRE DE LA BASE DE DATOS
** LA SEPARACION PARA EL ESPACIO ENTRE EL NOMBRE DEL CAMPO Y EL TIPO
** LA SEPARACION PARA EL INDICE Y EL TAG
	SET SAFETY OFF 
	SET CENTURY ON 
	SET DATE TO DMY 
	SET DEFAULT TO &CAMINO
	ARCHI = CAMINO+"\"+ALLTRIM(BASEDATO)+".FOX"
	DELETE FILE &ARCHI
	ARCHI = CAMINO+"\"+ALLTRIM(BASEDATO)+".MyS"
	DELETE FILE &ARCHI


***CREA BASE PARA VISUAL FOXPRO
***********************************************
IFOR = 0
FOR IFOR = 1 TO 2 

	ARCHI = CAMINO+"\TMPTABLAS.DBF"
	IF FILE(ARCHI) THEN
		IF USED("TMPTABLAS") THEN
			SELECT TMPTABLAS
			USE
		ENDIF
		DELETE FILE &CAMINO\TMPTABLAS.DBF
		DELETE FILE &CAMINO\TMPTABLAS.CDX
	ENDIF
	CREATE DBF &CAMINO\TMPTABLAS FREE (NTABLA C(80), N2TABLA C(50))
	
IF UPPER(SUBSTR(ALLTRIM(BASEDATO),LEN(ALLTRIM(BASEDATO))-2,3)) == "DBC" THEN 
	ARBO = CAMINO+"\"+BASEDATO
	OPEN DATABASE &ARBO
	DISPLAY TABLES TO FILE &CAMINO\LASTABLAS.TXT NOCONSOLE 
	SELECT TMPTABLAS
	APPEND FROM &CAMINO\LASTABLAS.TXT SDF
	SELECT TMPTABLAS
	REPLACE ALL NTABLA WITH ALLTRIM(NTABLA)
	GO 4
	DO WHILE !EOF()
		FOR I = 1 TO 80
			IF SUBSTR(NTABLA,I,1)=" " THEN 
				EXIT
			ENDIF 
		ENDFOR 
		REPLACE N2TABLA WITH SUBSTR(NTABLA,1,I)
		SKIP
	ENDDO
	SELECT tmptablas   
	INDEX ON ALLTRIM(N2TABLA) TAG N2TABLA 
	
	GO top
	SKIP 3
	DO WHILE !EOF()
		ARCHIVO = CAMINO+"\"+ALLTRIM(N2TABLA)
		USE &ARCHIVO IN 0
		ARCHIVO = ALLTRIM(N2TABLA)
		SELECT &ARCHIVO
		COPY STRUCTURE EXTENDED TO &CAMINO\ESTRUCTU
		USE &CAMINO\ESTRUCTU IN 0 
		SELECT ESTRUCTU

		IF IFOR = 1 THEN 
			=ESTRUFOX()
		ELSE
			=ESTRUPOS()
		ENDIF 
		
		SELECT ESTRUCTU
		USE
		SELECT TMPTABLAS
		SKIP
	ENDDO
	CLOSE TABLES ALL 
	DELETE FILE &CAMINO\ESTRUCTU.FPT
	DELETE FILE &CAMINO\ESTRUCTU.DBF
	DELETE FILE &CAMINO\LASTABLAS.TXT
	DELETE FILE &CAMINO\TMPTABLAS.DBF
	DELETE FILE &CAMINO\TMPTABLAS.CDX
ELSE
	SELECT TMPTABLAS
	APPEND BLANK 
	REPLACE N2TABLA WITH SUBSTR(ALLTRIM(BASEDATO),1,LEN(ALLTRIM(BASEDATO))-4)
	DO WHILE !EOF()
		ARCHIVO = CAMINO+"\"+ALLTRIM(N2TABLA)
		USE &ARCHIVO IN 0
		ARCHIVO = ALLTRIM(N2TABLA)
		SELECT &ARCHIVO
		COPY STRUCTURE EXTENDED TO &CAMINO\ESTRUCTU
		USE &CAMINO\ESTRUCTU IN 0 
		SELECT ESTRUCTU

		IF IFOR = 1 THEN 
			=ESTRUFOX()
		ELSE
			=ESTRUPOS()
		ENDIF 
		
		SELECT ESTRUCTU
		USE
		SELECT TMPTABLAS
		SKIP
	ENDDO
	CLOSE TABLES ALL 
	DELETE FILE &CAMINO\ESTRUCTU.FPT
	DELETE FILE &CAMINO\ESTRUCTU.DBF
	DELETE FILE &CAMINO\TMPTABLAS.DBF
	DELETE FILE &CAMINO\TMPTABLAS.CDX
ENDIF

ENDFOR 



FUNCTION ESTRUPOS
	ARVO = CAMINO+"\"+ALLTRIM(BASEDATO)+".SQL"
	IMPRENGLON = " "
	IF FILE(ARVO)  && ¿Existe el archivo?
		PUNTERO = FOPEN(ARVO,12)  && Si existe, abrir para lectura-escritura
	ELSE
		PUNTERO = FCREATE(ARVO)  && Si no, crearlo
		IMPRENGLON = "*ARCHIVO CREADO  : "+TTOC(DATETIME())
		=FPUTS(PUNTERO, IMPRENGLON )
		=FPUTS(PUNTERO, CHR(13))
	ENDIF
	IF PUNTERO < 0  && Comprobar si hay error al abrir el archivo
		RETURN .F.
	ELSE  && Si no hay error, escribir en archivo
		=FSEEK(PUNTERO,0,2)
		
*		IMPRENGLON = "*TABLA : "+UPPER(ALLTRIM(TMPTABLAS.N2TABLA))+".DBF"
*		=FPUTS(PUNTERO, IMPRENGLON )
		=FPUTS(PUNTERO, CHR(13))
		IMPRENGLON = "create table "+lower(ALLTRIM(TMPTABLAS.N2TABLA))+" ( "
		=FPUTS(PUNTERO, IMPRENGLON )
		
		SELECT ESTRUCTU
		GO TOP
		ultimo = RECCOUNT()
		DO WHILE !EOF()
			IF ultimo = RECNO() THEN 
				ultiparte = " not null , "
			ELSE
				ultiparte = " not null , "
			ENDIF 
			DO CASE
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "C"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  char("+ALLTRIM(STR(FIELD_LEN))+")"+(ultiparte)&&, ;" && ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "N"
					IF ESTRUCTU.FIELD_DEC > 0 THEN 
*						IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  FLOAT("+ALLTRIM(STR(FIELD_LEN))+","+ALLTRIM(STR(FIELD_DEC))+")"+(ultiparte) &&, ;" &&, ;"+CHR(13)
						IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  float "+(ultiparte) &&, ;" &&, ;"+CHR(13)
					ELSE
						IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  integer"+(ultiparte) &&, ;" &&, ;"+CHR(13)
					ENDIF 
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) =  "Y"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  float "+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) =  "D"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  date"+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) =  "T"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  datetime "+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "L"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  char(1)"+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "M"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  char(200) "+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "I"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  integer "+(ultiparte) &&,;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "G"
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  G"+(ultiparte) &&,;" &&, ;"+CHR(13)
				OTHERWISE 
					IMPRENGLON = SPACE(13)+lower(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+" ¿¿¿VERIFICAR TIPO ??? , ;" &&;"+CHR(13)
			ENDCASE

			=FPUTS(PUNTERO, IMPRENGLON )
			SELECT ESTRUCTU
			SKIP
		ENDDO 
*		IMPRENGLON = "                     )" 
*		=FPUTS(PUNTERO, IMPRENGLON )
*		=FPUTS(PUNTERO, CHR(13))

		ARBO = ALLTRIM(TMPTABLAS.N2TABLA)
		SELECT &ARBO
		FOR I = 1 TO 50 
			IF !EMPTY(TAG(I)) THEN 
				IMPRENGLON = SPACE(13)+"index "+LOWER(ALLTRIM(TAG(I)))+" ("+LOWER(ALLTRIM(SYS(14,I)))+"), "
				=FPUTS(PUNTERO, IMPRENGLON )			
			ELSE 
				EXIT
			ENDIF 
*			IMPRENGLON = "INDEX ON "+ALLTRIM(SYS(14,I))+SPACE(SEP2-LEN(ALLTRIM(SYS(14,I))))+" TAG "+ALLTRIM(TAG(I))

*			IMPRENGLON = SPACE(13)+"INDEX "+ALLTRIM(TAG(I))+" ("+ALLTRIM(SYS(14,I))+SPACE(SEP2-LEN(ALLTRIM(SYS(14,I))))+"), "
*			IMPRENGLON = SPACE(13)+"index "+LOWER(ALLTRIM(TAG(I)))+" ("+LOWER(ALLTRIM(SYS(14,I)))+"), "
*			=FPUTS(PUNTERO, IMPRENGLON )
		ENDFOR 
		
		=FPUTS(PUNTERO, CHR(13))
		=FPUTS(PUNTERO, ") TYPE = InnoDB ;")
		=FPUTS(PUNTERO, " ")
		=FPUTS(PUNTERO, " ")
	ENDIF
	=FCLOSE(PUNTERO)  && Cerrar archivo
*	CLOSE ALL 


**** EN MYSQL CORRER DESDE LA LINEA DE COMANDO SHELL REVISAR ANTES EL ARCHIVO.
****		mysql -h 127.0.0.1 -u root -D basedato < archivo.sql

RETURN 



 
FUNCTION ESTRUFOX
	ARVO = CAMINO+"\"+ALLTRIM(BASEDATO)+".FOX"
	IMPRENGLON = ""
	IF FILE(ARVO)  && ¿Existe el archivo?
		PUNTERO = FOPEN(ARVO,12)  && Si existe, abrir para lectura-escritura
	ELSE
		PUNTERO = FCREATE(ARVO)  && Si no, crearlo
		IMPRENGLON = "*ARCHIVO CREADO  : "+TTOC(DATETIME())
		=FPUTS(PUNTERO, IMPRENGLON )
		=FPUTS(PUNTERO, CHR(13))
	ENDIF
	IF PUNTERO < 0  && Comprobar si hay error al abrir el archivo
		RETURN .F.
	ELSE  && Si no hay error, escribir en archivo
		=FSEEK(PUNTERO,0,2)
		
		IMPRENGLON = "*TABLA : "+UPPER(ALLTRIM(TMPTABLAS.N2TABLA))+".DBF"
		=FPUTS(PUNTERO, IMPRENGLON )
		=FPUTS(PUNTERO, CHR(13))
		IMPRENGLON = "CREATE TABLE "+UPPER(ALLTRIM(TMPTABLAS.N2TABLA))+" ( ;"
		=FPUTS(PUNTERO, IMPRENGLON )
		
		SELECT ESTRUCTU
		GO TOP
		ultimo = RECCOUNT()
		DO WHILE !EOF()
			IF ultimo = RECNO() THEN 
				ultiparte = " )"
			ELSE
				ultiparte = ", ;"
			ENDIF 
			DO CASE
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "C"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  C("+ALLTRIM(STR(FIELD_LEN))+")"+(ultiparte)&&, ;" && ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "N"
					IF ESTRUCTU.FIELD_DEC > 0 THEN 
						IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  N("+ALLTRIM(STR(FIELD_LEN))+","+ALLTRIM(STR(FIELD_DEC))+")"+(ultiparte) &&, ;" &&, ;"+CHR(13)
					ELSE
						IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  N("+ALLTRIM(STR(FIELD_LEN))+")"+(ultiparte) &&, ;" &&, ;"+CHR(13)
					ENDIF 
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) =  "Y"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  Y"+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) =  "D"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  D"+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) =  "T"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  T"+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "L"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  L"+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "M"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  M"+(ultiparte) &&, ;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "I"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  I"+(ultiparte) &&,;" &&, ;"+CHR(13)
				CASE ALLTRIM(ESTRUCTU.FIELD_TYPE) = "G"
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+"  G"+(ultiparte) &&,;" &&, ;"+CHR(13)
				OTHERWISE 
					IMPRENGLON = SPACE(13)+UPPER(ALLTRIM(FIELD_NAME))+SPACE(SEP1-LEN(ALLTRIM(FIELD_NAME)))+" ¿¿¿VERIFICAR TIPO ??? , ;" &&;"+CHR(13)
			ENDCASE

			=FPUTS(PUNTERO, IMPRENGLON )
			SELECT ESTRUCTU
			SKIP
		ENDDO 
*		IMPRENGLON = "                     )" 
*		=FPUTS(PUNTERO, IMPRENGLON )
		=FPUTS(PUNTERO, CHR(13))

		ARBO = ALLTRIM(TMPTABLAS.N2TABLA)
		SELECT &ARBO
		FOR I = 1 TO 50 
			IF !EMPTY(TAG(I)) THEN 
				IMPRENGLON = "INDEX ON "+ALLTRIM(SYS(14,I))+SPACE(SEP2-LEN(ALLTRIM(SYS(14,I))))+" TAG "+ALLTRIM(TAG(I))
				=FPUTS(PUNTERO, IMPRENGLON )			
			ELSE
				EXIT
			ENDIF 
*			IMPRENGLON = "INDEX ON "+ALLTRIM(SYS(14,I))+SPACE(SEP2-LEN(ALLTRIM(SYS(14,I))))+" TAG "+ALLTRIM(TAG(I))
*			=FPUTS(PUNTERO, IMPRENGLON )
		ENDFOR 
		=FPUTS(PUNTERO, CHR(13))
		=FPUTS(PUNTERO, "*************************************************************************")
		=FPUTS(PUNTERO, "*************************************************************************")
	ENDIF
	=FCLOSE(PUNTERO)  && Cerrar archivo
RETURN 



